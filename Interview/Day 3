WITH first_visit as (select customer_id, min(order_date) as first_visit_date from customer_orders group by customer_id)
Select co.order_date, SUM(CASE when co.order_date = fv.first_visit_date then 1 else 0 end)as first_visit_flag,
SUM(CASE when co.order_date != fv.first_visit_date then 1 else 0 end)as repeat_visit_flag
FROM customer_orders co INNER JOIN first_visit fv ON co.customer_id = fv.customer_id group by co.order_date;
